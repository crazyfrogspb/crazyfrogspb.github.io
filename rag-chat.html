---
layout: default
title: RAG-—á–∞—Ç
---

<style>
        /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —è–∫–æ—Ä—è–º */
        html {
            scroll-behavior: smooth;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #667eea;
        }

        .message.assistant .message-avatar {
            background: #764ba2;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 18px;
            position: relative;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: #f1f3f4;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .sources {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        .sources h4 {
            margin: 0 0 10px 0;
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .source-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —è–∫–æ—Ä–Ω–æ–π —Å—Å—ã–ª–∫–µ */
        .source-item:target {
            background: #f0f4ff;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .source-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .source-title a {
            color: #667eea;
            text-decoration: none;
            transition: all 0.2s;
        }

        .source-title a:hover {
            color: #5a6fd8;
            text-decoration: underline;
        }

        .source-content {
            color: #666;
            line-height: 1.4;
        }

        .input-container {
            padding: 20px;
            background: #f8f9fa;
        }

        .input-box {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            min-height: 50px;
            max-height: 120px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 16px;
            resize: none;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: #667eea;
        }

        .send-button {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: #667eea;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover:not(:disabled) {
            background: #5a6fd8;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            padding: 10px 20px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }

        .status.loading {
            color: #667eea;
        }

        .status.error {
            color: #dc3545;
            background: #f8d7da;
        }

        .typing-indicator {
            display: none;
            padding: 15px 20px;
            color: #666;
            font-style: italic;
        }

        .typing-indicator.show {
            display: block;
        }

        .welcome-message {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>RAG-—á–∞—Ç</h1>
            <p>–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ø–æ—Å—Ç–∞–º –∏–∑ –∫–∞–Ω–∞–ª–∞ –í–∞—Ä–∏–º-–ú–õ</p>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="welcome-message">
                –ü—Ä–∏–≤–µ—Ç! –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –æ–± ML, –ò–ò-–∏–Ω—Å—Ç—Ä—É–º–Ω—Ç–∞—Ö, –∫–∞—Ä—å–µ—Ä–µ, –∞–≤—Ç–æ—Ä–µ –∫–∞–Ω–∞–ª–∞.
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            –ò—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –≥–æ—Ç–æ–≤–ª—é –æ—Ç–≤–µ—Ç...
        </div>

        <div class="input-container">
            <div class="input-box">
                <textarea id="messageInput" class="input-field" placeholder="–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏..."
                    rows="1" disabled></textarea>
                <button id="sendButton" class="send-button" disabled>
                    ‚û§
                </button>
            </div>
        </div>

        <div class="status" id="status">
            –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RAG-—Å–∏—Å—Ç–µ–º—ã...
        </div>
    </div>

    <script src="/assets/js/vector-search.js"></script>
    <script>
        class RAGChat {
            constructor() {
                this.vectorSearch = new VectorSearch();
                this.chatContainer = document.getElementById('chatContainer');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.statusElement = document.getElementById('status');
                this.typingIndicator = document.getElementById('typingIndicator');

                this.cloudflareWorkerUrl = 'http://localhost:3001/chat';

                // –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π)
                this.chatHistory = [];
                this.maxHistoryLength = 6; // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç

                this.initializeEventListeners();
                this.initialize();
            }

            initializeEventListeners() {
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Auto-resize textarea
                this.messageInput.addEventListener('input', () => {
                    this.messageInput.style.height = 'auto';
                    this.messageInput.style.height = this.messageInput.scrollHeight + 'px';
                });
            }

            async initialize() {
                try {
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤–≤–æ–¥ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    this.disableInput();

                    this.showStatus('–ó–∞–≥—Ä—É–∂–∞–µ–º RAG-–¥–∞–Ω–Ω—ã–µ...', 'loading');
                    await this.vectorSearch.loadData();

                    this.showStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥-–º–æ–¥–µ–ª—å...', 'loading');
                    await this.vectorSearch.initializeWorker();

                    this.showStatus('RAG-—Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!');
                    setTimeout(() => this.hideStatus(), 2000);

                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤–≤–æ–¥ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    this.enableInput();

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    this.showStatus('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ RAG-—Å–∏—Å—Ç–µ–º—ã', 'error');
                    // –í–≤–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
                }
            }

            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message) return;

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ UI
                this.addMessage(message, 'user');
                this.messageInput.value = '';
                this.messageInput.style.height = 'auto';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
                this.showTyping();
                this.disableInput();

                try {
                    // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫
                    const searchResults = await this.vectorSearch.search(message, {
                        limit: 5,
                        threshold: 0.1
                    });

                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM (—Å –∏—Å—Ç–æ—Ä–∏–µ–π —á–∞—Ç–∞)
                    const response = await this.generateLLMResponse(message, searchResults.chunks, this.chatHistory);

                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä–∞ –ø—Ä–æ—Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–∑ –æ—Ç–≤–µ—Ç–∞
                    const citedNumbers = this.extractCitedSources(response.answer);

                    // –§–∏–ª—å—Ç—Ä—É–µ–º sources - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ
                    const citedSources = citedNumbers.length > 0
                        ? citedNumbers
                            .map(num => searchResults.chunks[num - 1]) // num - 1 –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å 1, –∞ –∏–Ω–¥–µ–∫—Å—ã —Å 0
                            .filter(chunk => chunk !== undefined) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ –Ω–æ–º–µ—Ä –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                        : []; // –ï—Å–ª–∏ –Ω–µ—Ç —Ü–∏—Ç–∞—Ç - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
                    this.addMessage(response.answer, 'assistant', citedSources);

                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
                    this.chatHistory.push(
                        { role: 'user', content: message },
                        { role: 'assistant', content: response.answer }
                    );

                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –∏—Å—Ç–æ—Ä–∏–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π)
                    if (this.chatHistory.length > this.maxHistoryLength) {
                        this.chatHistory = this.chatHistory.slice(-this.maxHistoryLength);
                    }

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    this.addMessage('–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'assistant');
                } finally {
                    this.hideTyping();
                    this.enableInput();
                }
            }

            async generateLLMResponse(query, chunks, chatHistory = []) {
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤
                const context = chunks.map((chunk, index) =>
                    `[${index + 1}] ${chunk.post_title}: ${chunk.content}`
                ).join('\n\n');

                // –û—Ç–ª–∞–¥–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ LLM
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ LLM:', {
                    query: query,
                    chunksCount: chunks.length,
                    contextLength: context.length,
                    historyLength: chatHistory.length,
                    chunks: chunks.map((chunk, i) => ({
                        index: i + 1,
                        title: chunk.post_title,
                        contentLength: chunk.content.length,
                        contentPreview: chunk.content.substring(0, 100) + '...',
                        score: chunk.score?.toFixed(4),
                        bm25Score: chunk.bm25Score?.toFixed(4),
                        semanticScore: chunk.semanticScore?.toFixed(4)
                    }))
                });
                console.log('üìù –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM:', context);
                console.log('üí¨ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞:', chatHistory);

                const response = await fetch(this.cloudflareWorkerUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        context: context,
                        history: chatHistory,
                        model: 'google/gemma-3-27b-it:free'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
                    const errorMessage = data.message || data.error || `HTTP ${response.status}: ${response.statusText}`;
                    throw new Error(errorMessage);
                }

                return data;
            }

            addMessage(content, sender, sources = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;

                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.textContent = sender === 'user' ? '–í—ã' : 'ü§ñ';

                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';

                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º markdown —Å—Å—ã–ª–∫–∏ –≤ HTML –¥–ª—è assistant —Å–æ–æ–±—â–µ–Ω–∏–π
                if (sender === 'assistant') {
                    const htmlContent = this.markdownToHtml(content);
                    contentDiv.innerHTML = htmlContent;
                } else {
                    contentDiv.textContent = content;
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
                if (sender === 'assistant' && sources && sources.length > 0) {
                    const sourcesDiv = document.createElement('div');
                    sourcesDiv.className = 'sources';

                    const sourcesTitle = document.createElement('h4');
                    sourcesTitle.textContent = '–ò—Å—Ç–æ—á–Ω–∏–∫–∏:';
                    sourcesDiv.appendChild(sourcesTitle);

                    sources.forEach((source, index) => {
                        const sourceItem = document.createElement('div');
                        sourceItem.className = 'source-item';
                        sourceItem.id = `source-${index + 1}`; // ID –¥–ª—è —è–∫–æ—Ä–Ω—ã—Ö —Å—Å—ã–ª–æ–∫

                        const sourceTitle = document.createElement('div');
                        sourceTitle.className = 'source-title';

                        // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç
                        if (source.post_url) {
                            const link = document.createElement('a');
                            link.href = source.post_url;
                            link.textContent = `${index + 1}. ${source.post_title}`;
                            link.target = '_blank';
                            link.style.color = 'inherit';
                            link.style.textDecoration = 'none';
                            sourceTitle.appendChild(link);
                        } else {
                            sourceTitle.textContent = `${index + 1}. ${source.post_title}`;
                        }

                        const sourceContent = document.createElement('div');
                        sourceContent.className = 'source-content';
                        sourceContent.textContent = source.content.substring(0, 200) + '...';

                        sourceItem.appendChild(sourceTitle);
                        sourceItem.appendChild(sourceContent);
                        sourcesDiv.appendChild(sourceItem);
                    });

                    contentDiv.appendChild(sourcesDiv);
                }

                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);

                // –£–¥–∞–ª—è–µ–º welcome message –µ—Å–ª–∏ –µ—Å—Ç—å
                const welcomeMessage = this.chatContainer.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }

                this.chatContainer.appendChild(messageDiv);
                this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
            }

            showTyping() {
                this.typingIndicator.classList.add('show');
            }

            hideTyping() {
                this.typingIndicator.classList.remove('show');
            }

            disableInput() {
                this.messageInput.disabled = true;
                this.sendButton.disabled = true;
            }

            enableInput() {
                this.messageInput.disabled = false;
                this.sendButton.disabled = false;
                this.messageInput.placeholder = '–ù–∞–ø–µ—á–∞—Ç–∞–π —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å —Ç—É—Ç...';
                this.messageInput.focus();
            }

            showStatus(message, type = '') {
                this.statusElement.textContent = message;
                this.statusElement.className = `status ${type}`;
                this.statusElement.style.display = 'block';
            }

            hideStatus() {
                this.statusElement.style.display = 'none';
            }

            /**
             * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–º–µ—Ä–∞ –ø—Ä–æ—Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
             * –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞ [1], [2], [1, 5] –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
             */
            extractCitedSources(text) {
                const citedNumbers = new Set();

                // –ò—â–µ–º –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∏–¥–∞ [1], [2, 3], [1, 5, 7] –∏ —Ç.–¥.
                const regex = /\[([\d,\s]+)\]/g;
                let match;

                while ((match = regex.exec(text)) !== null) {
                    const numbers = match[1];
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª
                    if (/^[\d,\s]+$/.test(numbers)) {
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ
                        const nums = numbers.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                        nums.forEach(num => citedNumbers.add(num));
                    }
                }

                return Array.from(citedNumbers).sort((a, b) => a - b);
            }

            /**
             * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π markdown –≤ HTML
             * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: —Å—Å—ã–ª–∫–∏ [text](url), —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ [1] –∏–ª–∏ [1, 5], –∂–∏—Ä–Ω—ã–π **text**, –∫—É—Ä—Å–∏–≤ *text*, –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
             */
            markdownToHtml(markdown) {
                let html = markdown;

                // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML —Ç–µ–≥–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                html = html.replace(/</g, '&lt;').replace(/>/g, '&gt;');

                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º markdown —Å—Å—ã–ª–∫–∏ [text](url) –≤ HTML (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –î–û –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —á–∏—Å–ª–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫)
                html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color: #667eea; text-decoration: underline;">$1</a>');

                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ [1, 5] –∏–ª–∏ [1, 2, 3]
                html = html.replace(/\[([\d,\s]+)\]/g, (match, numbers) => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª (–º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—è—Ç—ã–µ –∏ –ø—Ä–æ–±–µ–ª—ã)
                    if (/^[\d,\s]+$/.test(numbers)) {
                        const nums = numbers.split(',').map(n => n.trim()).filter(n => n);
                        const links = nums.map(num =>
                            `<a href="#source-${num}" style="color: #667eea; text-decoration: underline; cursor: pointer;"><span class="source-ref" data-source="${num}">${num}</span></a>`
                        );
                        return '[' + links.join(', ') + ']';
                    }
                    return match; // –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                });

                // –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç **text**
                html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

                // –ö—É—Ä—Å–∏–≤ *text*
                html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');

                // –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                html = html.replace(/\n/g, '<br>');

                return html;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —á–∞—Ç
        document.addEventListener('DOMContentLoaded', () => {
            new RAGChat();
        });
    </script>