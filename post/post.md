Я долгое время хотел переехать с Телеграфа на другую платформу:
- Ограничение на длину постов
- Очень неудобно грузить картинки, приходится пользоваться внешними хостингами + это ненадёжно
- Хочется видеть все посты в одном месте, искать по ним, сортировать

Один из [блогов](https://eugeneyan.com/), которые мне нравятся, сделан на связке Jekyll + Github Pages. Что особенно приятно, это [бесплатно](https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/creating-a-github-pages-site-with-jekyll), но блог должен лежать в публичном репозитории. По ходу работы количество хотелок начало разрастаться - например, мне захотелось добавить RAG-чат вместо обычного поиска. В первую очередь, чтобы протестировать, как добавлять такие штуки на сайты, но и в качестве забавной игрушки сгодится.

Какие требования у меня были к сайту:
- Минималистичный дизайн
- Сортировка постов по просмотрам и по дате
- Фильтрация по тегам
- Страничка "Обо мне"
- RAG-чат
  - Эмбеддинг-моделей на OpenRouter нет, поэтому я решил поугарать и попробовать запустить маленькую модель прямо в браузере на клиенте
  - Безопасный доступ к LLM - чтоб никто не мог украсть мои ключики или абьюзить чат, задавая нерелевантные вопросы
  - Чтоб можно было задавать follow-up вопросы
  
Итак, что же у меня получилось, и какие технологии я применил?

# Фронтенд и деплой
В основе лежит Jekyll. Это генератор статических сайтов, который берёт HTML-шаблоны и контент в Markdown (в моём случае посты из Варим МЛ) и генерирует набор статических файлов (.html, .css, .js), которые затем публикуются на Github Pages. Посты лежат в _posts, шаблоны в _layouts и _includes (здесь лежит переиспользуемый футер). В конфиге можно выбрать тему и нужные плагины.

Любой пуш в [репозиторий](https://github.com/crazyfrogspb/crazyfrogspb.github.io) тригерит пересборку сайта через [jekyll build](https://github.com/crazyfrogspb/crazyfrogspb.github.io/actions/runs/20297971265/job/58296152906). Буквально через минутку обновления уже доступны [тут](https://crazyfrogspb.github.io/). Для тестов можно сёрвить локально через bundle exec jekyll serve.

## Добавление постов

Новый пост я сейчас пишу в маркдаун-формате (например, в IDE) с шапкой мета-данных в формате YAML front matter, коммичу, и вот он на сайте, можно публиковать в канал. Если точнее, то есть специальный питоновский скрипт, который из маркдауна с постом генерит нужные мета-данные, рассовывает картинки в нужные папки и так далее.

А что делать со старыми постами? Естественно, нужно автоматизировать процесс сбора. Подключаемся к Telegram через [Telethon](https://github.com/LonamiWebs/Telethon), сканируем канал Варим МЛ, ищем все ссылки на Telegraph-посты и на гугл-доки (была парочка постов через них). Далее
- Скачиваем контент поста
- Через Telegram API забираем количество просмотров
- Генерируем краткое описание поста через OpenRouter
- Создаём маркдаун-файл

# RAG-чат
Самый сложный компонент сайта - это RAG-чат. Давайте по кусочкам разберём, из чего он состоит, и какие решения были приняты.

## Retrieval
Для начала нам нужно почистить посты и нарезать их на чанки. Пишем питон-скрипт, который загружает маркдаун, удаляет лишние символы и информацию, а затем создаёт чанки из саммери и из самого текста поста. Чанкование я тут решил сделать простое, 512 символов с перекрытием в 50 символов, разбиение самое простое, просто по пробелам.




## LLM

## Чат